/\*\*

- ğŸ“Š DIAGRAMA DE FLUJO - DETECCIÃ“N DE INICIO DE ANOMALÃA
  \*/

/\*\*

- FLUJO GENERAL (Vista de Alto Nivel)
- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-
-                    Usuario carga CSV
-                          â”‚
-                          â†“
-                  ImportarDerivacion()
-                          â”‚
-                          â†“
-            analizarConsumoCompleto()
-                          â”‚
-                          â†“
-                  ConsumoMensual[]
-                 (datos agregados)
-                          â”‚
-                          â†“
-              HeatMapConsumo.tsx recibe
-                          â”‚
-                          â†“
-         useEffect(() => {
-           detectarInicioAnomalia(datos)
-         }, [datos])
-                          â”‚
-                          â†“
-              ResultadoDeteccionInicio
-                          â”‚
-                          â†“
-           Banner visualizado en UI
-          (âœ… / âš ï¸ / â“ segÃºn resultado)
  \*/

/\*\*

- LÃ“GICA INTERNA - ÃRBOL DE DECISIÃ“N
- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-
- INPUT: ConsumoMensual[] (datos ordenados cronolÃ³gicamente)
-          â”‚
-          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
-                        â†“
-        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
-        â”‚ Â¿ValidaciÃ³n bÃ¡sica OK?             â”‚
-        â”‚ (datos.length > 0?)                â”‚
-        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
-                   NO â”‚         SÃ
-                      â†“         â†“
-              "Sin datos"   Continuar
-                                 â”‚
-                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
-                    â†“                         â†“
-        LOOP 1: Descenso Brusco        LOOP 2: Descenso Sostenido
-        Para i=1 hasta n               Para i=3 hasta n
-        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
-        â”‚ Â¿actual < anterior    â”‚       â”‚ Â¿Hay 3 descensos         â”‚
-        â”‚   por 30%+?           â”‚       â”‚   consecutivos >10%?      â”‚
-        â”‚ (variaciÃ³n â‰¤ -30%)    â”‚       â”‚                          â”‚
-        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
-               NO â”‚     SÃ                     NO â”‚      SÃ
-                  â†“     â†“                        â†“      â†“
-            Continuar   MATCH!           Continuar   MATCH!
-                        â”‚                          â”‚
-                        â†“                          â†“
-            "Descenso brusco     "Descenso sostenido
-             >= 30%"              3+ meses"
-            Confianza: 95%        Confianza: 85%
-                        â”‚                          â”‚
-                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
-                                  â†“
-                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
-                    â”‚ Â¿VariaciÃ³n HistÃ³rica?     â”‚
-                    â”‚ vs. mismo mes aÃ±os        â”‚
-                    â”‚ anteriores                â”‚
-                    â”‚ (>20% diferencia?)        â”‚
-                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
-                           NO â”‚      SÃ
-                              â†“      â†“
-                         Continuar   MATCH!
-                                       â”‚
-                                       â†“
-                            "DesviaciÃ³n histÃ³rica
-                             >20%"
-                            Confianza: 80%
-                                       â”‚
-                                       â†“
-                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
-                    â”‚ Â¿Consumo Cero?            â”‚
-                    â”‚ Sospechoso               â”‚
-                    â”‚ (nunca ocurriÃ³ antes)    â”‚
-                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
-                           NO â”‚      SÃ
-                              â†“      â†“
-                         Continuar   MATCH!
-                                       â”‚
-                                       â†“
-                            "Consumo cero
-                             sospechoso"
-                            Confianza: 70%
-                                       â”‚
-                                       â†“
-                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
-                    â”‚ Ninguno de los 4         â”‚
-                    â”‚ criterios coincidiÃ³       â”‚
-                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
-                              â†“
-                      "Sin anomalÃ­a"
-                      Confianza: 90%
  \*/

/\*\*

- DETALLE DE CADA CRITERIO
- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-
- CRITERIO 1: DESCENSO BRUSCO (Mes a Mes)
- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
-
- for i = 1 to datos.length {
- actual = datos[i]
- anterior = datos[i-1]
-
- if (anterior.consumoActivaTotal > 0) {
-     variacion = (actual - anterior) / anterior * 100
-
-     if (variacion â‰¤ -30%) {
-       DETECTADO âœ…
-       return {
-         clasificacion: 'anomalia_detectada',
-         mensaje: `DeterminaciÃ³n del descenso en ${actual.mes}/${actual.aÃ±o}`,
-         razon: `Descenso >= 30% (${variacion}%)`,
-         confianza: 95
-       }
-     }
- }
- }
-
- Ejemplo:
- Enero: 500 kWh
- Febrero: 320 kWh
- VariaciÃ³n: (320-500)/500 = -36% â† Coincide (â‰¤ -30%)
- âœ… "DeterminaciÃ³n del descenso en febrero 2024"
-
-
- CRITERIO 2: DESCENSO SOSTENIDO (3+ Meses Consecutivos)
- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
-
- for i = 3 to datos.length {
- descensosConsecutivos = 0
-
- for j = i down to 1 {
-     variacion = (datos[j] - datos[j-1]) / datos[j-1] * 100
-
-     if (variacion < -10%) {
-       descensosConsecutivos++
-     } else {
-       break // Se rompe la serie
-     }
- }
-
- if (descensosConsecutivos â‰¥ 3) {
-     DETECTADO âœ…
-     periodoInicio = datos[i - descensosConsecutivos]
-     return {
-       clasificacion: 'anomalia_detectada',
-       mensaje: `...DeterminaciÃ³n del descenso en ${periodoInicio}`,
-       razon: `Descenso sostenido ${descensosConsecutivos} meses`,
-       confianza: 85
-     }
- }
- }
-
- Ejemplo:
- Enero: 500 kWh
- Febrero: 450 kWh (-10%) âœ“
- Marzo: 405 kWh (-10%) âœ“
- Abril: 365 kWh (-10%) âœ“
- Mayo: 365 kWh (-0%) âœ— Se rompe
- â†’ 3 descensos consecutivos
- âœ… "DeterminaciÃ³n del descenso en febrero 2024"
-
-
- CRITERIO 3: VARIACIÃ“N HISTÃ“RICA (vs. Mismo Mes en AÃ±os Anteriores)
- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
-
- for registro in datos.filter(d => d.aÃ±o === aÃ±oActual) {
- promedioHistorico = promedio(
-     datos.filter(d => d.mes === registro.mes && d.aÃ±o < aÃ±oActual)
- )
-
- if (promedioHistorico > 0) {
-     variacion = (registro.consumo - promedioHistorico) / promedioHistorico * 100
-
-     if (ABS(variacion) > 20%) {
-       DETECTADO âœ…
-       return {
-         clasificacion: 'anomalia_detectada',
-         mensaje: `DeterminaciÃ³n del descenso en ${registro.mes}/${registro.aÃ±o}`,
-         razon: `DesviaciÃ³n ${variacion}% vs histÃ³rico`,
-         historicoPromedio: promedioHistorico,
-         confianza: 80
-       }
-     }
- }
- }
-
- Ejemplo:
- Enero promedio (2022-2023): (500 + 480) / 2 = 490 kWh
- Enero 2024: 390 kWh
- VariaciÃ³n: (390 - 490) / 490 = -20.4%
- â†’ ABS(-20.4%) > 20% âœ“
- âœ… "DesviaciÃ³n > 20% vs histÃ³rico de enero"
-
-
- CRITERIO 4: CONSUMO CERO SOSPECHOSO (DesvÃ­o del PatrÃ³n)
- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
-
- for i = 0 to datos.length {
- registro = datos[i]
-
- if (registro.consumo === 0) {
-     // Â¿OcurriÃ³ cero en este mes en aÃ±os anteriores?
-     cerosEnMes = datos.filter(
-       d => d.mes === registro.mes && d.aÃ±o < registro.aÃ±o && d.consumo === 0
-     )
-
-     if (cerosEnMes.length === 0) {
-       // PRIMERA VEZ EN CERO PARA ESTE MES
-       DETECTADO âœ…
-       return {
-         clasificacion: 'anomalia_detectada',
-         mensaje: `...consumo cero sospechoso`,
-         razon: `Consumo cero en mes donde nunca antes ocurriÃ³`,
-         confianza: 70
-       }
-     }
-     // else: Es esperado (patrÃ³n histÃ³rico)
- }
- }
-
- Ejemplo:
- 2022 Febrero: 450 kWh
- 2023 Febrero: 470 kWh
- 2024 Febrero: 0 kWh (PRIMERA VEZ)
- â†’ cerosEnMes.length === 0
- âœ… "Consumo cero sospechoso"
- â“ Pregunta al usuario: "Â¿Hubo baja en febrero 2024?"
  \*/

/\*\*

- RESULTADOS POSIBLES
- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-
- 1.  DESCENSO BRUSCO
- clasificacion: 'anomalia_detectada'
- confianza: 95
- UI: Banner ROJO con âš ï¸
-
- 2.  DESCENSO SOSTENIDO
- clasificacion: 'anomalia_detectada'
- confianza: 85
- UI: Banner ROJO con âš ï¸
-
- 3.  VARIACIÃ“N HISTÃ“RICA
- clasificacion: 'anomalia_detectada'
- confianza: 80
- UI: Banner ROJO con âš ï¸
-
- 4.  CONSUMO CERO SOSPECHOSO
- clasificacion: 'anomalia_detectada'
- confianza: 70
- UI: Banner ROJO con âš ï¸
-
- 5.  SIN ANOMALÃA
- clasificacion: 'sin_anomalia'
- confianza: 90
- UI: Banner VERDE con âœ…
-
- 6.  PERIODO INDETERMINADO
- clasificacion: 'periodo_indeterminado'
- confianza: 0-50
- UI: Banner NARANJA con â“
  \*/

/\*\*

- ORDEN DE EVALUACIÃ“N (PRIORIDAD)
- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-
- 1ï¸âƒ£ Descenso Brusco (95% confianza)
- â†’ Si coincide, devuelve inmediatamente
- â†’ No evalÃºa los demÃ¡s
-
- 2ï¸âƒ£ Descenso Sostenido (85% confianza)
- â†’ Solo si descenso brusco NO coincidiÃ³
- â†’ Si coincide, devuelve inmediatamente
-
- 3ï¸âƒ£ VariaciÃ³n HistÃ³rica (80% confianza)
- â†’ Solo si los 2 anteriores NO coincidieron
- â†’ Si coincide, devuelve inmediatamente
-
- 4ï¸âƒ£ Consumo Cero Sospechoso (70% confianza)
- â†’ Solo si los 3 anteriores NO coincidieron
- â†’ Si coincide, devuelve inmediatamente
-
- 5ï¸âƒ£ Sin AnomalÃ­a (90% confianza)
- â†’ Si ninguno de los 4 anteriores coincidiÃ³
- â†’ Devuelve por defecto
-
- ğŸ“Œ NOTA: Una vez que coincide un criterio, se detiene
- y NO evalÃºa los demÃ¡s. Por eso devuelve ÃšNICO resultado.
  \*/

/\*\*

- INTEGRACIÃ“N EN UI (HeatMapConsumo.tsx)
- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-
- 1.  Usuario abre ExpedienteTipoV
- 2.  Carga datos CSV
- 3.  analisisConsumoCompleto() genera ConsumoMensual[]
- 4.  HeatMapConsumo recibe datos
- 5.  useEffect executa:
- useEffect(() => {
-      if (datos.length > 0) {
-        const resultado = detectarInicioAnomalia(datos);
-        setResultadoAnomalia(resultado);
-      }
- }, [datos]);
- 6.  Estado actualizado
- 7.  Componente renderiza banner:
- {resultadoAnomalia && (
-      <div className={`anomalia-banner anomalia-banner--${clasificacion}`}>
-        {/* Contenido segÃºn clasificaciÃ³n */}
-      </div>
- )}
- 8.  CSS aplica estilos segÃºn clase:
- .anomalia-banner--sin_anomalia { color: green; }
- .anomalia-banner--anomalia_detectada { color: red; }
- .anomalia-banner--periodo_indeterminado { color: orange; }
- 9.  Usuario ve resultado visualmente
      \*/

/\*\*

- PERFORMANCE
- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-
- Complejidad Temporal: O(n)
- - Itera mÃ¡ximo una vez por criterio
- - N = nÃºmero de periodos (tÃ­picamente 12-36)
-
- Complejidad Espacial: O(1)
- - No crea arrays internos grandes
- - Solo variables de control
-
- Tiempo de EjecuciÃ³n: < 5ms para 100 periodos
- - PrÃ¡cticamente instantÃ¡neo
- - No afecta performance de UI
    \*/

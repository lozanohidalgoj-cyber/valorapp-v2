{
  "fecha": "2025-11-13T22:45:12.697Z",
  "resumen": {
    "consoleLogs": 59,
    "debugStatements": 4,
    "archivosGrandes": 16,
    "vulnerabilidades": 0,
    "codigoComentado": 153
  },
  "detalles": {
    "consoleLogs": [
      {
        "archivo": "src\\pages\\ExpedienteTipoV\\components\\VistaAnomalias.tsx",
        "linea": 47,
        "codigo": "console.warn(`No se encontr√≥ fila con periodo: ${periodo}`);"
      },
      {
        "archivo": "src\\pages\\ExpedienteTipoV\\components\\VistaAnomalias.tsx",
        "linea": 178,
        "codigo": "console.log('[TIPOS] Tipos de comportamiento extra√≠dos:', resultado);"
      },
      {
        "archivo": "src\\pages\\ExpedienteTipoV\\components\\VistaAnomalias.tsx",
        "linea": 184,
        "codigo": "console.log('[FILTER] Filtrando con tipos:', tipoComportamientoFilter);"
      },
      {
        "archivo": "src\\pages\\ExpedienteTipoV\\components\\VistaAnomalias.tsx",
        "linea": 211,
        "codigo": "console.log("
      },
      {
        "archivo": "src\\pages\\ExpedienteTipoV\\components\\VistaAnomalias.tsx",
        "linea": 217,
        "codigo": "console.log(`[FILTER] ${registro.periodo}: \"${tipoRegistro}\" coincide`);"
      },
      {
        "archivo": "src\\pages\\ExpedienteTipoV\\components\\VistaMensual.tsx",
        "linea": 32,
        "codigo": "console.warn(`No se encontr√≥ fila con periodo: ${periodo}`);"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 141,
        "codigo": "console.group('üîç CLASIFICACI√ìN DE EXPEDIENTE - DEBUG');"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 142,
        "codigo": "console.log('%c‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'color: #0000d0; font-weight: bold');"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 143,
        "codigo": "console.log('Total periodos:', consumosMensuales.length);"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 144,
        "codigo": "console.log("
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 151,
        "codigo": "console.log("
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 310,
        "codigo": "console.log('%c[RECUPERACIONES] DETECTADAS:', 'color: #00ff00; font-weight: bold');"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 311,
        "codigo": "console.table("
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 548,
        "codigo": "console.log("
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 552,
        "codigo": "console.log('  Inicio periodo:', inicioPeriodoFinal);"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 553,
        "codigo": "console.log('  √çndice inicio:', indiceInicioAnalisis);"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 554,
        "codigo": "console.log('  Promedio despu√©s anomal√≠a:', promedioDespuesAnomalia.toFixed(0), 'kWh');"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 555,
        "codigo": "console.log('  Variaci√≥n vs global:', variacionVsGlobal.toFixed(1), '%');"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 556,
        "codigo": "console.groupEnd();"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 1057,
        "codigo": "console.log('%c[CANDIDATOS] A INICIO DE ANOMAL√çA:', 'color: #00ff00; font-weight: bold');"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 1058,
        "codigo": "console.table("
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 1066,
        "codigo": "console.log('%c[SELECCIONADO]:', 'color: #ff3184; font-weight: bold', candidatos[0].periodo);"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 830,
        "codigo": "console.group('üîç DETECCI√ìN DE ANOMAL√çAS - DEBUG');"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 831,
        "codigo": "console.log('%c‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'color: #0000d0; font-weight: bold');"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 832,
        "codigo": "console.log('%cRegla 0 (Tendencia):', 'font-weight: bold', resultadosRegla0.length, 'resultados');"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 834,
        "codigo": "console.log('  ‚Üí', r.periodoLegible, '- Confianza:', r.confianza)"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 837,
        "codigo": "console.log("
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 844,
        "codigo": "console.log('  ‚Üí', r.periodoLegible, '- Confianza:', r.confianza)"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 847,
        "codigo": "console.log("
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 854,
        "codigo": "console.log('  ‚Üí', r.periodoLegible, '- Confianza:', r.confianza)"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 857,
        "codigo": "console.log("
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 864,
        "codigo": "console.log('  ‚Üí', r.periodoLegible, '- Confianza:', r.confianza)"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 867,
        "codigo": "console.log("
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 874,
        "codigo": "console.log('  ‚Üí', r.periodoLegible, '- Confianza:', r.confianza)"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 877,
        "codigo": "console.log('%c‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'color: #0000d0; font-weight: bold');"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 878,
        "codigo": "console.log("
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 883,
        "codigo": "console.groupEnd();"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 899,
        "codigo": "console.log("
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 903,
        "codigo": "console.log('  Periodo:', anomaliasDetectadas[0].periodoLegible);"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 904,
        "codigo": "console.log('  Tipo:', anomaliasDetectadas[0].detalles.tipo);"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 905,
        "codigo": "console.log('  Confianza:', anomaliasDetectadas[0].confianza);"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 906,
        "codigo": "console.log('  Raz√≥n:', anomaliasDetectadas[0].razon);"
      },
      {
        "archivo": "src\\services\\loggerService.ts",
        "linea": 95,
        "codigo": "console.error(message, entry.context, entry.error);"
      },
      {
        "archivo": "src\\services\\loggerService.ts",
        "linea": 98,
        "codigo": "console.warn(message, entry.context);"
      },
      {
        "archivo": "src\\services\\loggerService.ts",
        "linea": 101,
        "codigo": "console.debug(message, entry.context);"
      },
      {
        "archivo": "src\\services\\loggerService.ts",
        "linea": 104,
        "codigo": "console.log(message, entry.context);"
      },
      {
        "archivo": "src\\services\\persistenciaService.ts",
        "linea": 69,
        "codigo": "console.error('Error al guardar datos:', error);"
      },
      {
        "archivo": "src\\services\\persistenciaService.ts",
        "linea": 73,
        "codigo": "console.warn('Cuota de localStorage excedida. Limpiando datos antiguos...');"
      },
      {
        "archivo": "src\\services\\persistenciaService.ts",
        "linea": 97,
        "codigo": "console.warn('Datos recuperados no son un array v√°lido');"
      },
      {
        "archivo": "src\\services\\persistenciaService.ts",
        "linea": 103,
        "codigo": "console.error('Error al recuperar datos:', error);"
      },
      {
        "archivo": "src\\services\\persistenciaService.ts",
        "linea": 115,
        "codigo": "console.error('Error al guardar filtros:', error);"
      },
      {
        "archivo": "src\\services\\persistenciaService.ts",
        "linea": 132,
        "codigo": "console.error('Error al recuperar filtros:', error);"
      },
      {
        "archivo": "src\\services\\persistenciaService.ts",
        "linea": 144,
        "codigo": "console.error('Error al guardar configuraci√≥n:', error);"
      },
      {
        "archivo": "src\\services\\persistenciaService.ts",
        "linea": 166,
        "codigo": "console.error('Error al recuperar configuraci√≥n:', error);"
      },
      {
        "archivo": "src\\services\\persistenciaService.ts",
        "linea": 188,
        "codigo": "console.error('Error al recuperar √∫ltima sesi√≥n:', error);"
      },
      {
        "archivo": "src\\services\\persistenciaService.ts",
        "linea": 202,
        "codigo": "console.error('Error al limpiar datos:', error);"
      },
      {
        "archivo": "src\\services\\persistenciaService.ts",
        "linea": 214,
        "codigo": "console.error('Error al limpiar datos antiguos:', error);"
      },
      {
        "archivo": "src\\services\\persistenciaService.ts",
        "linea": 241,
        "codigo": "console.error('Error al calcular tama√±o de datos:', error);"
      },
      {
        "archivo": "src\\services\\persistenciaService.ts",
        "linea": 282,
        "codigo": "console.error('Error al importar backup:', error);"
      }
    ],
    "debugStatements": [
      {
        "archivo": "src\\pages\\Averia\\Averia.tsx",
        "linea": 21,
        "tipo": "alert"
      },
      {
        "archivo": "src\\pages\\ExpedienteTipoV\\ExpedienteTipoV.tsx",
        "linea": 295,
        "tipo": "confirm"
      },
      {
        "archivo": "src\\pages\\Home\\Home.tsx",
        "linea": 18,
        "tipo": "alert"
      },
      {
        "archivo": "src\\pages\\SaldoATR\\SaldoATR.tsx",
        "linea": 199,
        "tipo": "confirm"
      }
    ],
    "archivosGrandes": [
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "lineas": 1136,
        "caracteres": 43729,
        "esComponente": false
      },
      {
        "archivo": "src\\pages\\ExpedienteTipoV\\components\\VistaAnomalias.tsx",
        "lineas": 1105,
        "caracteres": 42117,
        "esComponente": true
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "lineas": 1027,
        "caracteres": 37980,
        "esComponente": false
      },
      {
        "archivo": "src\\components\\HeatMapConsumo\\HeatMapConsumo.tsx",
        "lineas": 987,
        "caracteres": 40299,
        "esComponente": true
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "lineas": 945,
        "caracteres": 31240,
        "esComponente": false
      },
      {
        "archivo": "src\\types\\index.ts",
        "lineas": 513,
        "caracteres": 14691,
        "esComponente": false
      },
      {
        "archivo": "src\\pages\\SaldoATR\\SaldoATR.tsx",
        "lineas": 494,
        "caracteres": 16844,
        "esComponente": true
      },
      {
        "archivo": "src\\pages\\ExpedienteTipoV\\ExpedienteTipoV.tsx",
        "lineas": 492,
        "caracteres": 15960,
        "esComponente": true
      },
      {
        "archivo": "src\\services\\importDerivacionService.ts",
        "lineas": 482,
        "caracteres": 13028,
        "esComponente": false
      },
      {
        "archivo": "src\\pages\\SaldoATR\\components\\SaldoATRTable.tsx",
        "lineas": 308,
        "caracteres": 10506,
        "esComponente": true
      },
      {
        "archivo": "src\\utils\\index.ts",
        "lineas": 307,
        "caracteres": 8786,
        "esComponente": false
      },
      {
        "archivo": "src\\pages\\ExpedienteTipoV\\components\\VistaGrafico.tsx",
        "lineas": 306,
        "caracteres": 10600,
        "esComponente": true
      },
      {
        "archivo": "src\\services\\exportacionService.ts",
        "lineas": 293,
        "caracteres": 9025,
        "esComponente": false
      },
      {
        "archivo": "src\\services\\persistenciaService.ts",
        "lineas": 286,
        "caracteres": 7210,
        "esComponente": false
      },
      {
        "archivo": "src\\services\\extractorMetricasService.ts",
        "lineas": 247,
        "caracteres": 6965,
        "esComponente": false
      },
      {
        "archivo": "src\\components\\DeteccionAnomalia\\DeteccionAnomalia.tsx",
        "lineas": 239,
        "caracteres": 8131,
        "esComponente": true
      }
    ],
    "dependenciasNoUsadas": [],
    "vulnerabilidades": 0,
    "codigoComentado": [
      {
        "archivo": "src\\components\\DeteccionAnomalia\\DeteccionAnomalia.tsx",
        "linea": 30,
        "codigo": "// Calcular baseline usando promedio diario de los primeros 12 meses (o 30% de los datos)"
      },
      {
        "archivo": "src\\components\\HeatMapConsumo\\HeatMapConsumo.tsx",
        "linea": 28,
        "codigo": "// 0% = 0 (rojo), 100% = 0.5 (amarillo), 200% = 1 (verde)"
      },
      {
        "archivo": "src\\components\\HeatMapConsumo\\HeatMapConsumo.tsx",
        "linea": 32,
        "codigo": "// 0-100%: mapear a 0-0.5 (rojo a amarillo)"
      },
      {
        "archivo": "src\\components\\HeatMapConsumo\\HeatMapConsumo.tsx",
        "linea": 35,
        "codigo": "// 100-200%: mapear a 0.5-1 (amarillo a verde)"
      },
      {
        "archivo": "src\\components\\HeatMapConsumo\\HeatMapConsumo.tsx",
        "linea": 44,
        "codigo": "// Rojo ‚Üí Amarillo (0 a 0.5)"
      },
      {
        "archivo": "src\\components\\HeatMapConsumo\\HeatMapConsumo.tsx",
        "linea": 50,
        "codigo": "// Amarillo ‚Üí Verde (0.5 a 1)"
      },
      {
        "archivo": "src\\components\\HeatMapConsumo\\HeatMapConsumo.tsx",
        "linea": 338,
        "codigo": "// Siempre priorizar callback externo si existe (navegaci√≥n/scroll en tablas)"
      },
      {
        "archivo": "src\\pages\\ExpedienteTipoV\\components\\VistaAnomalias.tsx",
        "linea": 239,
        "codigo": "// Parsear fechas (formato dd/mm/yyyy)"
      },
      {
        "archivo": "src\\pages\\ExpedienteTipoV\\components\\VistaAnomalias.tsx",
        "linea": 415,
        "codigo": "// 2. Contar ceros esperados (estacionalidad)"
      },
      {
        "archivo": "src\\pages\\ExpedienteTipoV\\components\\VistaAnomalias.tsx",
        "linea": 434,
        "codigo": "// 3. Detectar descensos sostenidos (3+ meses consecutivos)"
      },
      {
        "archivo": "src\\pages\\SaldoATR\\SaldoATR.tsx",
        "linea": 144,
        "codigo": "// Estado local de filas (puede ser actualizado por importaci√≥n)"
      },
      {
        "archivo": "src\\pages\\SaldoATR\\SaldoATR.tsx",
        "linea": 392,
        "codigo": "// Eliminado bot√≥n de exportaci√≥n en header; variable previa puedeExportar ya no se utiliza"
      },
      {
        "archivo": "src\\pages\\SaldoATR\\utils\\constants.ts",
        "linea": 7,
        "codigo": "// Letras de columna A..AT (46 columnas)"
      },
      {
        "archivo": "src\\pages\\SaldoATR\\utils\\constants.ts",
        "linea": 71,
        "codigo": "// Encabezados por defecto (fallback si no se ha importado archivo todav√≠a)"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 52,
        "codigo": "// 1. Suma Consumo Activa (P1 + P2 + P3)"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 60,
        "codigo": "// 2. M√°x de Max√≠metro (mayor valor de todos los periodos)"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 72,
        "codigo": "// 3. Periodos facturados (n√∫mero de facturas)"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 97,
        "codigo": "// ==================== FUNCIONES AUXILIARES PARA M√âTRICAS ADICIONALES ===================="
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 108,
        "codigo": "// Tomar hasta 6 meses previos (sin incluir el actual)"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 157,
        "codigo": "// Tendencia = (consumoActual - consumoHace3Meses) / 3"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 176,
        "codigo": "// Calcular d√≠as entre periodos (aproximado)"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 199,
        "codigo": "// Ratio = consumoTotal / (potencia * dias * 24)"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 256,
        "codigo": "// Agrupar por periodo (YYYY-MM)"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 408,
        "codigo": "// Calcular variaci√≥n porcentual usando CONSUMO TOTAL (no promedio diario)"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 468,
        "codigo": "// ==== NUEVAS M√âTRICAS ADICIONALES ===="
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 509,
        "codigo": "// ==== SEGUNDO PASO: CALCULAR M√âTRICAS QUE REQUIEREN TODA LA SERIE ===="
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 513,
        "codigo": "// Calcular promedios hist√≥ricos por mes (para √≠ndice estacional)"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 671,
        "codigo": "// let totalZerosPrevios = 0;"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 672,
        "codigo": "// let consecutivosZeros = 0;"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 675,
        "codigo": "// Primera pasada: detectar descensos mes a mes (usando consumo TOTAL)"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 692,
        "codigo": "// Identificar descensos sostenidos (3+ meses en ventana de 5 meses, tolerando 1-2 meses de recuperaci√≥n)"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 715,
        "codigo": "// Si hay 3 o m√°s descensos en la ventana, marcar TODO como sostenido (incluyendo recuperaciones)"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 724,
        "codigo": "// Calcular M√ÅXIMO hist√≥rico por mes (para detectar descensos desde picos)"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 754,
        "codigo": "// Pre-calcular mapa de ceros por mes (para detecci√≥n de patr√≥n estacional)"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 763,
        "codigo": "// Umbrales de clasificaci√≥n de comportamiento (basados en an√°lisis estad√≠stico)"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 806,
        "codigo": "// Obtener variaci√≥n mes-a-mes comparando CONSUMO TOTAL (no promedio diario)"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 816,
        "codigo": "// const siguiente = indice < ordenados.length - 1 ? ordenados[indice + 1] : undefined;"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 820,
        "codigo": "// const habiaCeroAntes = totalZerosPrevios > 0;"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 821,
        "codigo": "// const repetidoMasDeDos = consumoEsCero && consecutivosZeros + 1 > 2;"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 822,
        "codigo": "// const variacionPosterior = siguiente?.variacionPorcentual;"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 823,
        "codigo": "// const incrementoPosterior ="
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 824,
        "codigo": "//   consumoEsCero && typeof variacionPosterior === 'number' && variacionPosterior >= 40;"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 839,
        "codigo": "// - El mismo mes tiene ceros en otros a√±os (hist√≥rico) O"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 840,
        "codigo": "// - Es un mes t√≠picamente estacional (julio, agosto, diciembre, enero)"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 859,
        "codigo": "// üåç CRITERIO GLOBAL: Consumo muy bajo respecto al promedio global (Z-Score < -2.5)"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 878,
        "codigo": "// -10% a 0% (descensos menores)"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 909,
        "codigo": "// >= +50%"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 912,
        "codigo": "// +5% a +50% (aumentos moderados) - PERO verificar descenso global/hist√≥rico"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 968,
        "codigo": "// if (consumoEsCero) {"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 969,
        "codigo": "//   consecutivosZeros += 1;"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 970,
        "codigo": "//   totalZerosPrevios += 1;"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 971,
        "codigo": "// } else {"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 972,
        "codigo": "//   consecutivosZeros = 0;"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 973,
        "codigo": "// }"
      },
      {
        "archivo": "src\\services\\analisisConsumoService.ts",
        "linea": 976,
        "codigo": "// Calcular mesesConConsumo (ya tenemos mesesCero calculado antes del bucle principal)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 26,
        "codigo": "// Calcular baseline de primeros periodos (30% o m√°ximo 12 meses)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 73,
        "codigo": "// Verificar si es periodo sin anomal√≠as (comportamiento normal)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 89,
        "codigo": "// REGLA 1: No anomal√≠a - 0 esperado (patrones estacionales de ceros)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 98,
        "codigo": "// REGLA 2: Sin anomal√≠a (mayor√≠a verde/amarillo, patr√≥n estable)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 107,
        "codigo": "// REGLA 3: No objetivo por cambio de potencia (cambios frecuentes)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 116,
        "codigo": "// REGLA 4: Descenso sostenido (patr√≥n rojo/naranja dominante CON tendencia descendente)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 125,
        "codigo": "// REGLA 5: Anomal√≠a indeterminada (patrones mixtos sin tendencia clara)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 196,
        "codigo": "// const analisisVisual = analizarPatronMapaCalor(consumosMensuales);"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 199,
        "codigo": "// let clasificacionFinal = analisisVisual.patronDetectado as any;"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 200,
        "codigo": "// const mostrarInicio = analisisVisual.mostrarInicioAnomalia;"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 214,
        "codigo": "// IMPORTANTE: Ignorar los primeros 2 periodos (√≠ndices 0 y 1) porque no tienen hist√≥rico suficiente"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 227,
        "codigo": "// 2. CALCULAR ESTAD√çSTICAS GLOBALES (TODO EL HIST√ìRICO)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 238,
        "codigo": "// Promedio hist√≥rico por mes (para comparar enero con enero, febrero con febrero, etc.)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 255,
        "codigo": "// 2.5. ANALIZAR TENDENCIAS (‚â•3 descensos consecutivos / recuperaci√≥n)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 299,
        "codigo": "// 3.5. DETECTAR RECUPERACIONES (descensos temporales que luego se recuperaron)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 335,
        "codigo": "// 5. L√ìGICA DE CLASIFICACI√ìN (en orden de prioridad)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 337,
        "codigo": "// CASO 1: Todos los consumos son cero esperado (estacional)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 358,
        "codigo": "// CASO 2: Mayor√≠a de periodos con cero esperado (> 60%)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 381,
        "codigo": "// CASO 2.5: PRIORIDAD M√ÅXIMA - Cambio de potencia significativo (> 0.5 kW) durante inicio de anomal√≠a"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 412,
        "codigo": "// REGLA ACTUALIZADA (v3) ‚Äì Descenso sostenido progresivo:"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 415,
        "codigo": "//   1. Existe inicio estimado (heur√≠stica O bloque de descensos) O"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 416,
        "codigo": "//   2. An√°lisis de tendencia global muestra descenso significativo (promedio final < 70% promedio inicial)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 417,
        "codigo": "//   3. A partir del inicio: racha m√°xima consecutiva de periodos \"bajos\" >= RACHA_MINIMA O"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 418,
        "codigo": "//      mayor√≠a de periodos posteriores son bajos (>= 50%)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 420,
        "codigo": "//   5. \"Bajo\" = consumo <= FACTOR_CONSUMO_BAJO * promedioGlobal O zScore < ZSCORE_BAJO"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 445,
        "codigo": "// Detectar descenso sostenido por tendencia global (sin necesidad de inicio puntual)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 456,
        "codigo": "// ========= REGLA MEJORADA DE DESCENSO SOSTENIDO (v3) ========="
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 582,
        "codigo": "// Verifica que al menos algunos periodos est√©n fuera del rango normal (¬±1.5 desviaciones)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 595,
        "codigo": "// üîç VERIFICAR SI HAY CAMBIO DE POTENCIA (√∫ltima verificaci√≥n por si no se detect√≥ antes)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 648,
        "codigo": "// CASO NUEVO: Consumo bajo con picos (muchos periodos muy bajos y algunos picos aislados)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 650,
        "codigo": "// - ‚â•50% de los periodos con consumo <= 40% del promedioGlobal"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 651,
        "codigo": "// - Al menos 2 picos (consumo >= 140% del promedioGlobal)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 683,
        "codigo": "// CASO 6: Anomal√≠a indeterminada (comportamiento sin patrones claros de anomal√≠a)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 712,
        "codigo": "// ==================== FUNCIONES AUXILIARES ===================="
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 718,
        "codigo": "// Meses de verano (julio, agosto) e invierno (diciembre, enero)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 870,
        "codigo": "// Calcular promedio de los primeros 12 meses (o todos si hay menos)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 894,
        "codigo": "// FILTRO CR√çTICO 1: Ignorar si hubo cambio de potencia (‚â• 0.5 kW)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 917,
        "codigo": "// üéØ PRIORIDAD 1: Consumo CERO o extremadamente bajo (‚â§ 15 kWh)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 918,
        "codigo": "// Este es el indicador m√°s claro de anomal√≠a (fraude/aver√≠a)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 932,
        "codigo": "// üéØ PRIORIDAD 2: Descenso mes-a-mes fuerte (‚â§ -40%, relajado de -50%)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 948,
        "codigo": "// üéØ PRIORIDAD 2.5: Consumo muy bajo vs baseline (‚â§ 60% del promedio hist√≥rico)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 964,
        "codigo": "// üéØ PRIORIDAD 2.7: Descenso significativo vs baseline (< 70% Y descenso mes-a-mes)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 983,
        "codigo": "// üéØ PRIORIDAD 2.8: Descenso significativo vs promedio hist√≥rico del mes (< -50%)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 1000,
        "codigo": "// üéØ PRIORIDAD 3: Z-Score muy bajo (< -2.5) + consumo bajo vs baseline (< 40%)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 1016,
        "codigo": "// üéØ PRIORIDAD 4: Descenso fuerte + muy por debajo del hist√≥rico del mes (< -70%)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 1041,
        "codigo": "// 1. Priorizar por menor prioridad (1 es m√°s importante que 4)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 1042,
        "codigo": "// 2. Si hay empate, seleccionar el M√ÅS RECIENTE (mayor √≠ndice)"
      },
      {
        "archivo": "src\\services\\clasificadorExpedienteService.ts",
        "linea": 1049,
        "codigo": "// Segundo: m√°s reciente (mayor √≠ndice)"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 19,
        "codigo": "// ============================================================================"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 21,
        "codigo": "// ============================================================================"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 48,
        "codigo": "// ============================================================================"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 50,
        "codigo": "// ============================================================================"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 180,
        "codigo": "// Verificar si hay cambio reciente de consumo a cero (√∫ltimos 6 meses)"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 189,
        "codigo": "// Si hab√≠a consumo antes y ahora es cero = cambio reciente = sospechoso"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 388,
        "codigo": "// Encontrar TODOS los bloques de ‚â•3 descensos consecutivos (variaci√≥n < 0)"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 418,
        "codigo": "// Verificar si hay dos aumentos consecutivos (> 0)"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 466,
        "codigo": "// 1. Sin recuperaci√≥n confirmada (prioridad m√°xima)"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 505,
        "codigo": "// ============================================================================"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 507,
        "codigo": "// ============================================================================"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 753,
        "codigo": "// ============================================================================"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 754,
        "codigo": "// ÔøΩüîç DETECTOR PRINCIPAL (REFACTORIZADO)"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 755,
        "codigo": "// ============================================================================"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 829,
        "codigo": "// DEBUG: Log para consola (siempre visible)"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 888,
        "codigo": "// Primero por confianza (descendente)"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 892,
        "codigo": "// Si confianza igual, preferir m√°s reciente (a√±o descendente)"
      },
      {
        "archivo": "src\\services\\detectarInicioAnomaliaService.ts",
        "linea": 912,
        "codigo": "// =========================="
      },
      {
        "archivo": "src\\services\\exportacionService.ts",
        "linea": 281,
        "codigo": "// Hoja 3: Entrada datos (primeras 100 filas para no saturar)"
      },
      {
        "archivo": "src\\services\\extractorMetricasService.ts",
        "linea": 32,
        "codigo": "// consumoActivaTotal = suma de (P1 + P2 + P3) de todas las facturas del mes"
      },
      {
        "archivo": "src\\services\\extractorMetricasService.ts",
        "linea": 77,
        "codigo": "// ‚úÖ El servicio ya calcula MAX(P1...P6) de todas las facturas"
      },
      {
        "archivo": "src\\services\\extractorMetricasService.ts",
        "linea": 129,
        "codigo": "// ‚ö†Ô∏è ADVERTENCIA: Consumo muy bajo (posible baja contractual)"
      },
      {
        "archivo": "src\\services\\importDerivacionService.ts",
        "linea": 176,
        "codigo": "// Leer archivo (soporta .csv, .xlsx, .xls)"
      },
      {
        "archivo": "src\\services\\importDerivacionService.ts",
        "linea": 236,
        "codigo": "// Procesar filas de datos (desde fila 2)"
      },
      {
        "archivo": "src\\services\\importDerivacionService.ts",
        "linea": 249,
        "codigo": "// Continuar procesando (registro rechazado pero no para ejecuci√≥n)"
      },
      {
        "archivo": "src\\services\\importDerivacionService.ts",
        "linea": 261,
        "codigo": "// Generar vista previa (primeras 10 filas)"
      },
      {
        "archivo": "src\\services\\persistenciaService.ts",
        "linea": 46,
        "codigo": "// ============================================"
      },
      {
        "archivo": "src\\services\\persistenciaService.ts",
        "linea": 48,
        "codigo": "// ============================================"
      },
      {
        "archivo": "src\\services\\persistenciaService.ts",
        "linea": 211,
        "codigo": "// Eliminar solo los datos de derivaci√≥n (los m√°s pesados)"
      },
      {
        "archivo": "src\\types\\index.ts",
        "linea": 8,
        "codigo": "// ============================================"
      },
      {
        "archivo": "src\\types\\index.ts",
        "linea": 10,
        "codigo": "// ============================================"
      },
      {
        "archivo": "src\\types\\index.ts",
        "linea": 44,
        "codigo": "// ============================================"
      },
      {
        "archivo": "src\\types\\index.ts",
        "linea": 46,
        "codigo": "// ============================================"
      },
      {
        "archivo": "src\\types\\index.ts",
        "linea": 89,
        "codigo": "// ============================================"
      },
      {
        "archivo": "src\\types\\index.ts",
        "linea": 90,
        "codigo": "// ÔøΩ Tipos para Derivaci√≥n Individual (Entrada de Datos)"
      },
      {
        "archivo": "src\\types\\index.ts",
        "linea": 91,
        "codigo": "// ============================================"
      },
      {
        "archivo": "src\\types\\index.ts",
        "linea": 166,
        "codigo": "// ============================================"
      },
      {
        "archivo": "src\\types\\index.ts",
        "linea": 168,
        "codigo": "// ============================================"
      },
      {
        "archivo": "src\\types\\index.ts",
        "linea": 361,
        "codigo": "// ============================================"
      },
      {
        "archivo": "src\\types\\index.ts",
        "linea": 363,
        "codigo": "// ============================================"
      },
      {
        "archivo": "src\\types\\index.ts",
        "linea": 397,
        "codigo": "// ============================================"
      },
      {
        "archivo": "src\\types\\index.ts",
        "linea": 399,
        "codigo": "// ============================================"
      },
      {
        "archivo": "src\\types\\index.ts",
        "linea": 458,
        "codigo": "// ============================================"
      },
      {
        "archivo": "src\\types\\index.ts",
        "linea": 460,
        "codigo": "// ============================================"
      },
      {
        "archivo": "src\\types\\index.ts",
        "linea": 480,
        "codigo": "// ============================================"
      },
      {
        "archivo": "src\\types\\index.ts",
        "linea": 482,
        "codigo": "// ============================================"
      },
      {
        "archivo": "src\\utils\\index.ts",
        "linea": 185,
        "codigo": "// ============================================"
      },
      {
        "archivo": "src\\utils\\index.ts",
        "linea": 187,
        "codigo": "// ============================================"
      },
      {
        "archivo": "src\\utils\\index.ts",
        "linea": 271,
        "codigo": "// Rojo ‚Üí Amarillo (0 a 0.5)"
      },
      {
        "archivo": "src\\utils\\index.ts",
        "linea": 277,
        "codigo": "// Amarillo ‚Üí Verde (0.5 a 1)"
      }
    ]
  }
}
